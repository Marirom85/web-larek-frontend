# WEB-ларёк - Интернет-магазин для веб-разработчиков

## Cтек

- **TypeScript** - типизированный JavaScript
- **SCSS** - препроцессор для стилей
- **Webpack** - сборщик модулей
- **HTML5** - разметка страниц
- **EventEmitter** - брокер событий для связи компонентов

## Инструкция по сборке и запуску

### Установка зависимостей
```bash
npm install
```

### Запуск в режиме разработки
```bash
npm run start
```

### Сборка для продакшена
```bash
npm run build
```

## Архитектура проекта

Проект построен на основе **MVP** (Model-View-Presenter) архитектуры с использованием брокера событий для связи компонентов.

### Основные принципы архитектуры

1. **Изолированность** - каждый компонент может работать независимо
2. **Единственная ответственность** - каждый класс решает одну конкретную задачу
3. **Масштабируемость** - возможность легко добавлять новую функциональность
4. **Слабая связанность** - компоненты взаимодействуют через события
5. **Разделение ответственности** - модель управляет данными, представление отображает UI, обработчики связывают их

### Обновленная структура архитектуры (Event-driven MVP)

После рефакторинга архитектура стала более чистой и соответствует паттерну MVP:

```
┌─────────────┐     ┌─────────────────────┐     ┌─────────────┐
│    Model    │────▶│  Event Handlers     │────▶│    View     │
│  (Данные)   │     │  (Презентер)        │     │(Интерфейс)  │
└─────────────┘     └─────────────────────┘     └─────────────┘
       ▲                    │                    │
       │                    ▼                    │
       └─────────────┐     ┌─────────────┐     │
                     │     │EventEmitter │     │
                     │     │(События)    │     │
                     └────▶└─────────────┘◀────┘
```

### Ключевые изменения после рефакторинга:

1. **Создание события basket:change** - добавлено новое событие для отслеживания изменений корзины
2. **Реализация BasketView** - создан отдельный класс представления для корзины с методами обновления
3. **Статические компоненты** - BasketView и Success создаются один раз при загрузке приложения
4. **Перенос обработчиков DOM** - обработка кликов по кнопкам перенесена в соответствующие представления
5. **Использование данных сервера** - Success компонент теперь отображает номер заказа с сервера
6. **Эмитация событий формы** - формы заказа эмитируют события при изменении полей

### Преимущества новой архитектуры:

- **Устранено дублирование** - компоненты создаются один раз и переиспользуются
- **Улучшена производительность** - меньше созданий/удалений DOM элементов
- **Лучшее разделение ответственности** - каждая часть системы имеет четкую зону ответственности
- **Упрощено тестирование** - компоненты можно тестировать изолированно
- **Легче поддерживать** - изменения в одном компоненте не затрагивают другие

## Классы модели

### ProductModel (Модель товара)
**Поля:**
- `id: string` - уникальный идентификатор товара
- `title: string` - название товара
- `description: string` - описание товара
- `image: string` - URL изображения
- `category: ProductCategory` - категория товара ('soft', 'hard', 'other', 'additional', 'button')
- `price: number | null` - цена товара
- `inBasket: boolean` - флаг наличия товара в корзине

**Методы:**
- `getProducts(): IProductModel[]` - получить все товары
- `getProduct(id: string): IProductModel | null` - получить товар по ID
- `setProducts(products: IProduct[])` - установить список товаров
- `addToBasket(productId: string): void` - добавить товар в корзину
- `removeFromBasket(productId: string): void` - удалить товар из корзины
- `isInBasket(productId: string): boolean` - проверить наличие товара в корзине

### BasketModel (Модель корзины)
**Поля:**
- `items: IProductModel[]` - массив товаров в корзине
- `total: number` - общая стоимость товаров
- `count: number` - количество товаров в корзине

**Методы:**
- `getItems(): IProductModel[]` - получить все товары корзины
- `getTotal(): number` - получить общую стоимость
- `getCount(): number` - получить количество товаров
- `addItem(product: IProductModel): void` - добавить товар в корзину
- `removeItem(productId: string): void` - удалить товар из корзины
- `clear(): void` - очистить корзину
- `isEmpty(): boolean` - проверить пустоту корзины
- `syncWithProducts(products: IProductModel[]): void` - синхронизировать с продуктами

### OrderModel (Модель заказа)
**Поля:**
- `payment: PaymentMethod | null` - способ оплаты ('online', 'card')
- `address: string` - адрес доставки
- `email: string` - email покупателя
- `phone: string` - телефон покупателя
- `isValid: boolean` - флаг валидности данных

**Методы:**
- `getData(): IOrderModel` - получить данные заказа
- `setPayment(payment: PaymentMethod): void` - установить способ оплаты
- `setAddress(address: string): void` - установить адрес
- `setEmail(email: string): void` - установить email
- `setPhone(phone: string): void` - установить телефон
- `validate(): boolean` - проверить валидность данных
- `reset(): void` - сбросить данные заказа

## Классы представления

### ProductCard (Карточка товара в каталоге)
**Методы:**
- `setProduct(product: IProductModel): void` - установить товар для отображения
- `setInBasket(inBasket: boolean): void` - установить статус в корзине
- `render(): HTMLElement` - отрендерить карточку
- `destroy(): void` - уничтожить компонент

### ProductPreview (Карточка товара в модальном окне)
**Методы:**
- `setProduct(product: IProductModel): void` - установить товар для отображения
- `setInBasket(inBasket: boolean): void` - установить статус в корзине
- `render(): HTMLElement` - отрендерить превью
- `destroy(): void` - уничтожить компонент

### Basket (Корзина покупок) - **УСТАРЕВШИЙ**
**Методы:**
- `addItem(product: IProductModel): void` - добавить товар в корзину
- `removeItem(productId: string): void` - удалить товар из корзины
- `updateBasket(items: IProductModel[]): void` - обновить корзину
- `updateTotal(): void` - обновить общую стоимость
- `clear(): void` - очистить корзину
- `render(): HTMLElement` - отрендерить корзину
- `destroy(): void` - уничтожить компонент

### BasketView (Представление корзины) - **НОВЫЙ**
**Методы:**
- `updateItems(items: IProductModel[]): void` - обновить список товаров
- `updateTotal(total: number): void` - обновить общую стоимость
- `updateCount(count: number): void` - обновить счетчик товаров
- `render(): HTMLElement` - отрендерить представление корзины
- `destroy(): void` - уничтожить компонент

**Примечание:** BasketView заменяет старый компонент Basket и используется как статический компонент, создаваемый один раз при загрузке приложения.

### OrderForm (Форма заказа)
**Методы:**
- `setStep(step: 1 | 2): void` - установить шаг формы
- `validate(): boolean` - проверить валидность формы
- `getData(): IOrderModel` - получить данные формы
- `setData(data: Partial<IOrderModel>): void` - установить данные формы
- `render(): HTMLElement` - отрендерить форму
- `destroy(): void` - уничтожить компонент

### Success (Сообщение об успешном заказе) - **ОБНОВЛЕННЫЙ**
**Методы:**
- `setOrderData(total: number, orderId?: string): void` - установить данные заказа (общая сумма и номер заказа)
- `render(): HTMLElement` - отрендерить сообщение
- `destroy(): void` - уничтожить компонент

**Примечание:** Компонент теперь принимает данные с сервера и отображает номер заказа.

### Modal (Модальное окно)
**Методы:**
- `open(data?: any): void` - открыть модальное окно
- `close(): void` - закрыть модальное окно
- `setContent(content: HTMLElement): void` - установить содержимое
- `render(): HTMLElement` - отрендерить модальное окно
- `destroy(): void` - уничтожить компонент

### MainView (Главное представление)
**Методы:**
- `renderProducts(products: IProductModel[]): void` - отобразить товары
- `updateBasketCount(count: number): void` - обновить счетчик корзины
- `showLoading(): void` - показать загрузку
- `hideLoading(): void` - скрыть загрузку
- `showError(message: string): void` - показать ошибку
- `render(): HTMLElement` - отрендерить представление
- `destroy(): void` - уничтожить компонент

## Пользовательские события (EventEmitter)

### События товаров
- `products:loaded` - товары загружены (данные: { products: IProductModel[] })
- `product:add` - товар добавлен в корзину (данные: { product: IProductModel })
- `product:remove` - товар удален из корзины (данные: { productId: string })

### События корзины
- `basket:change` - корзина изменена (данные: { basket: IBasketModel }) - **НОВОЕ**
- `basket:update` - корзина обновлена (данные: { basket: IBasketModel }) - **УСТАРЕВШЕЕ**
- `basket:clear` - корзина очищена (данные: { basket: IBasketModel }) - **УСТАРЕВШЕЕ**

### События заказа
- `order:start` - начало оформления заказа
- `order:submit` - отправка заказа (данные: { data: IOrderModel })
- `order:success` - успешное оформление заказа
- `order:update` - обновление шага заказа (данные: { step: number })
- `order:payment:change` - изменение способа оплаты (данные: { payment: PaymentMethod }) - **НОВОЕ**
- `order:address:change` - изменение адреса доставки (данные: { address: string }) - **НОВОЕ**
- `order:email:change` - изменение email (данные: { email: string }) - **НОВОЕ**
- `order:phone:change` - изменение телефона (данные: { phone: string }) - **НОВОЕ**

### События модальных окон
- `modal:open` - открытие модального окна (данные: { type: string, data?: any })
- `modal:close` - закрытие модального окна

### События форм
- `form:validate` - валидация формы (данные: { form: string, isValid: boolean })

### События ошибок
- `error:show` - показ ошибки (данные: { message: string })

**Примечание:** События `basket:update` и `basket:clear` помечены как устаревшие и заменены на единое событие `basket:change`.

## Обработчики событий (в index.ts)

Вместо класса MainPresenter используется набор функций-обработчиков в файле index.ts:

**Основные функции:**
- `loadProducts(): Promise<void>` - загрузка товаров с API
- `openProductModal(productId: string): void` - открыть модальное окно товара
- `openBasketModal(): void` - открыть модальное окно корзины
- `addToBasket(productId: string): void` - добавить товар в корзину
- `removeFromBasket(productId: string): void` - удалить товар из корзины
- `startOrder(): void` - начать оформление заказа
- `submitOrder(): Promise<void>` - отправить заказ

**Обработчики событий:**
- `setupEventHandlers(): void` - настройка всех обработчиков событий EventEmitter
- Обработка `products:loaded` - отображение товаров и синхронизация корзины
- Обработка `product:add` - добавление товара в корзину
- Обработка `product:remove` - удаление товара из корзины
- Обработка `basket:update` - обновление счетчика корзины
- Обработка `order:start` - начало оформления заказа
- Обработка `order:submit` - отправка заказа
- Обработка `modal:open` - открытие модального окна
- Обработка `error:show` - показ ошибки

## Описание компонентов

### ProductCard (Карточка товара)
Компонент отображает информацию о товаре в каталоге. Функции:
- Показ изображения, названия, цены и категории товара
- Обработка клика для открытия детального просмотра
- Добавление товара в корзину

### Product (Карточка товара в модальном окне)
Компонент отображает детальную информацию о товаре. Функции:
- Показ полного описания товара
- Кнопки "В корзину" / "Убрать из корзины"
- Рендеринг UI для модального окна

### Basket (Корзина)
Компонент управляет корзиной покупок. Функции:
- Отображение списка товаров в корзине
- Подсчет общей стоимости
- Удаление товаров из корзины
- Переход к оформлению заказа

### OrderForm (Форма заказа)
Компонент для оформления заказа. Функции:
- **Шаг 1**: Выбор способа оплаты и ввод адреса доставки
- **Шаг 2**: Ввод email и телефона покупателя
- Валидация полей формы
- Отправка заказа на сервер

### Success (Сообщение об успешном заказе)
Компонент отображает результат успешного заказа. Функции:
- Показ сообщения об успешном оформлении
- Отображение списанной суммы
- Рендеринг UI для модального окна

## Типы данных

### API типы
- `Product` - товар с сервера
- `Order` - заказ для отправки на сервер
- `Customer` - данные покупателя

### Модель данных
- `ProductModel` - товар в приложении
- `BasketModel` - корзина покупок
- `OrderModel` - заказ в процессе оформления

### События
- `'product:add'` - добавление товара в корзину
- `'product:remove'` - удаление товара из корзины
- `'basket:update'` - обновление корзины
- `'order:submit'` - отправка заказа
- `'modal:open'` - открытие модального окна
- `'modal:close'` - закрытие модального окна

## Процессы в приложении

### Просмотр каталога
1. Загрузка товаров через API
2. Отображение карточек товаров
3. Обработка клика по карточке → открытие модального окна

### Работа с корзиной
1. Добавление товара → событие `'product:add'`
2. Обновление счетчика в шапке
3. Обновление списка товаров в корзине
4. Пересчет общей стоимости

### Оформление заказа
1. Валидация данных на каждом шаге
2. Активация кнопки "Далее" только при заполнении всех полей
3. Отправка заказа на сервер
4. Показ окна успешного заказа
5. Очистка корзины

### Управление модальными окнами
1. Открытие по событию `'modal:open'`
2. Закрытие по клику вне окна или на крестик
3. Предотвращение закрытия при клике внутри окна
4. Очистка содержимого при закрытии

**Архитектура модальных окон:**
- `Modal` - универсальный класс-обертка для модальных окон
- `ProductPreview`, `Basket`, `OrderForm`, `Success` - компоненты с UI, которые передаются в Modal
- Modal управляет отображением, закрытием и позиционированием
- Компоненты отвечают только за рендеринг своего содержимого

## Масштабируемость

Архитектура позволяет легко добавлять:
- Новые типы товаров
- Дополнительные способы оплаты
- Систему скидок и промокодов
- Историю заказов
- Личный кабинет пользователя
- Систему отзывов
- Фильтрацию и поиск товаров

Все изменения можно внедрять без изменения базового кода благодаря слабой связанности компонентов и использованию событий.
